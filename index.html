<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vendor Purchase Order â†’ PDF</title>
  <style>
    :root{--pad:12px;--radius:12px}
    body{font-family:Arial, sans-serif;background:#f4f4f9;margin:0;padding:20px;line-height:1.45}
    .container{max-width:980px;margin:auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
    h1{margin:0 0 10px;font-size:22px}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .toolbar label{font-weight:bold}
    .toolbar .spacer{flex:1}
    .filter{flex:1;min-width:220px}

    table{width:100%;border-collapse:collapse;margin-top:12px}
    table th, table td{border:1px solid #e5e5e5;padding:10px;text-align:left;vertical-align:top}
    table th{background:#2f3a4a;color:#fff;position:sticky;top:0;z-index:1}
    input[type=number]{width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;font-size:16px}
    input[readonly]{background:#eee}
    .btn{padding:12px 16px;border:none;border-radius:10px;cursor:pointer;font-weight:600}
    .btn-primary{background:#28a745;color:#fff}
    .btn-secondary{background:#0069d9;color:#fff}
    .btn.sticky{position:sticky;bottom:0;width:100%;box-shadow:0 -2px 8px rgba(0,0,0,.08);margin-top:10px}
    .status{margin-top:12px;padding:10px;border-radius:10px;font-size:14px}

    /* Section header rows for grouped spices */
    .section-header{
      font-weight:bold;
      background:#eef2ff;
      letter-spacing:0.03em;
      text-transform:uppercase;
    }

    /* ğŸ“± Mobile: turn table rows into cards */
    @media (max-width: 720px){
      table thead{display:none}
      table, tbody, tr, td{display:block;width:100%}
      tbody tr{background:#fff;border:1px solid #eee;border-radius:14px;box-shadow:0 1px 6px rgba(0,0,0,.06);padding:8px;margin:10px 0}
      tbody td{border:none;border-bottom:1px dashed #eee;padding:8px 6px;display:flex;gap:8px;justify-content:space-between;align-items:flex-start}
      tbody td:last-child{border-bottom:none}
      tbody td::before{content:attr(data-label);font-weight:700;color:#374151;padding-right:10px;flex:0 0 48%}
      tbody td > *{flex:1}
      .btn.sticky{position:static;width:100%}
      .toolbar{position:sticky;top:0;background:#fff;padding-bottom:8px;z-index:2}
      .section-header{display:block}
      .section-header::before{content:''}
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Vendor Purchase Order â†’ Auto-PDF</h1>
  <form id="poForm">
    <div class="toolbar">
      <label for="vendor">Vendor:</label>
      <select id="vendor">
        <option value="royal">Royal</option>
        <option value="meats">Meats</option>
        <option value="sysco">Sysco</option>
        <option value="igf">IGF</option>
        <option value="bar">Bar</option>
        <option value="sidney">Sidney's Spices</option>
      </select>
      <div class="spacer"></div>
      <input id="filter" class="filter" type="search" placeholder="Filter itemsâ€¦ (e.g., onions, salmon, paprika)" />
    </div>
    <table id="itemsTable">
      <thead>
        <tr id="tableHead"></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button type="submit" class="btn btn-primary sticky">Submit & Download PDF</button>
    <button type="button" id="shareBtn" class="btn btn-secondary sticky">Share via Text</button>
    <div id="testStatus" class="status"></div>
  </form>
</div>

<!-- Libraries MUST load without inline code -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Error trap: show on-screen message instead of blank page
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function(){
  function showError(msg){
    var el=document.getElementById('testStatus');
    if(!el){ el=document.createElement('div'); el.id='testStatus'; el.className='status'; document.body.appendChild(el); }
    el.textContent='Error: '+msg;
    el.style.color='#721c24'; el.style.background='#f8d7da'; el.style.border='1px solid #f5c6cb';
  }
  window.addEventListener('error',e=>showError(e.message));
  window.addEventListener('unhandledrejection',e=>showError((e.reason&&e.reason.message)||String(e.reason)));
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Inventory data
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const INVENTORY = {
  royal: [
    {name:"Onions, Jumbo Sweet(Vidalias)", pack:"25# Bag", minPar:"1/2 case", weekendPar:"1/2 case"},
    {name:"Onions, Jumbo Yellow",        pack:"25# Bag", minPar:"1/2 case", weekendPar:"1/2 case"},
    {name:"Onions, Red",                 pack:"5#",      minPar:"3 onions", weekendPar:"5#"},
    {name:"Potatoes, Red A",             pack:"50# bag", minPar:"1/2 case", weekendPar:"1 case"},
    {name:"Arugula, Baby",               pack:"3# cs",   minPar:"1/2 case", weekendPar:"1 case"},
    {name:"Asparagus, Standard",         pack:"11 lb case", minPar:"1/4 case", weekendPar:"1 case"},
    {name:"Garlic, Whole Peeled",        pack:"5# jar",  minPar:"1/2 case", weekendPar:"1 case"},
    {name:"Mushrooms, Shitake",          pack:"3# cs",   minPar:"1/2 case", weekendPar:"1 case"},
    {name:"Salad Mix",                   pack:"3# cs",   minPar:"1 case",   weekendPar:"2 cases"},
    {name:"Shallots, Large",             pack:"5 lb bag",minPar:"1/4 case", weekendPar:"1/2 case"},
    {name:"Spinach, Baby",               pack:"3 lb case", minPar:"1 case", weekendPar:"2 cases"},
    {name:"Beets",                        pack:"25 lb bag", minPar:"1/2 case", weekendPar:"1/2 case"},
    {name:"Bell Pepper, Red",            pack:"5#",      minPar:"2.5#",     weekendPar:"1 case"},
    {name:"Bell Pepper, Yellow",         pack:"5#",      minPar:"2.5#",     weekendPar:"1 case"},
    {name:"French Beans (check prep!)",  pack:"5#",      minPar:"2.5#",     weekendPar:"1 case"},
    {name:"Cucumber, Fancy",             pack:"12 ct case", minPar:"4 cucumbers", weekendPar:"1/2 case"},
    {name:"Green Onions",                pack:"12 ct case", minPar:"12 ct", weekendPar:"12 ct"},
    {name:"Habaneros",                   pack:"1#",      minPar:"1",        weekendPar:"1"},
    {name:"Tomato, Ripe Roma",           pack:"25# cs",  minPar:"1/2 case", weekendPar:"1 case"},
    {name:"Japanese Sweet Pots",         pack:"40# cs",  minPar:"1/4 case", weekendPar:"1/4 case"},
    {name:"Zucchini, Fancy",             pack:"25# cs",  minPar:"1/4 case", weekendPar:"1/2 case"},
    {name:"Eggplant, Medium",            pack:"25# cs",  minPar:"Order after checking nana's eggplant", weekendPar:""},
    {name:"Lettuce, Romaine Hearts",     pack:"48 ct cs",minPar:"1/2 case", weekendPar:"1 case"},
    {name:"Parsley, Italian",            pack:"3 bunch bag", minPar:"2 bags", weekendPar:"2 bags"},
    {name:"Honeydew (Thursday only)",    pack:"ea, lg ripe", minPar:"2",    weekendPar:"2"},
    {name:"Seedless Watermelon (Thu)",   pack:"ea, lg",  minPar:"1",        weekendPar:"1"},
    {name:"Lemon Juice",                 pack:"1 qt",    minPar:"6",        weekendPar:"6"},
    {name:"Lime Juice",                  pack:"1 qt",    minPar:"2",        weekendPar:"2"},
    {name:"Lemons, 200ct",               pack:"1 cs",    minPar:"1/4 case", weekendPar:"1/2 case"},
    {name:"Limes, SMALL",                pack:"1#",      minPar:"1/2 case", weekendPar:"1 case"},
    {name:"Oranges, Navel, 56-ct seedless", pack:"1 cs", minPar:"1/4 case", weekendPar:"1/2 case"},
    {name:"Avocado (ripe)",              pack:"6 ea",    minPar:"3 ea",     weekendPar:"6 ea"},
    {name:"Basil, Hawaiian",             pack:"#",       minPar:"1",        weekendPar:"2"},
    {name:"Cilantro",                    pack:"bunch",   minPar:"8 bunches", weekendPar:"8 bunches"},
    {name:"Dill",                        pack:"1/4#",    minPar:"1/4 case", weekendPar:"1/4 case"},
    {name:"Spearmint",                   pack:"1/4#",    minPar:"1/4 case", weekendPar:"1/4 case"},
    {name:"Oregano, Big Leaf, thick stem", pack:"1/4#",  minPar:"1/4 case", weekendPar:"1/4 case"},
    {name:"Thyme, thick stem",           pack:"1/4#",    minPar:"1/4 case", weekendPar:"1/4 case"},
    {name:"Sage, Hawaiian",              pack:"#",       minPar:"1/2 case", weekendPar:"1 case"},
    {name:"Eggs",                        pack:"cs",      minPar:"15 dz",    weekendPar:"30 dz"},
    {name:"Cream",                       pack:"cs",      minPar:"1 cs",     weekendPar:"2 cs"},
    {name:"Raspberry Puree",             pack:"cs",      minPar:"1",        weekendPar:"1"},
    {name:"Blood Orange Puree",          pack:"cs",      minPar:"1",        weekendPar:"1"},
    {name:"Red Jalapenos",               pack:"1#",      minPar:"1/2 case", weekendPar:"1 case"}
  ],
  meats: [
    {name:"Chicken Breast",                        pack:"20# cs", minPar:"1 cs",   weekendPar:"1 cs"},
    {name:"CAB Hangar Steak cleaned - 4 oz portion", pack:"10# cs", minPar:"5#",  weekendPar:"10#"},
    {name:"Calamari, Fresh 5/7 TT 10#",           pack:"25# cs",  minPar:"7.5#",  weekendPar:"1/2 cs"},
    {name:"Ground Lamb (Imported)",               pack:"10# cs",  minPar:"1/2 cs", weekendPar:"1/2 cs"},
    {name:"Lamb Tenders",                         pack:"25# cs",  minPar:"1/2 cs", weekendPar:"1/2 cs"},
    {name:"Lump Crab Meat, Red Swimming",         pack:"6 1# cs", minPar:"4 1# cans", weekendPar:"4 1# cans"},
    {name:"PEI Mussels",                          pack:"10# bag", minPar:"1 bag", weekendPar:"2 bags"},
    {name:"Shrimp, Ocean Garden Wild 16/20",      pack:"20# cs",  minPar:"4 bags of 2#", weekendPar:"full cs"},
    {name:"Tuna Steaks, 6oz",                     pack:"10# cs",  minPar:"1/4 cs", weekendPar:"1/2 cs"},
    {name:"Whole Salmon, Faroe 11-13#",           pack:"10# cs",  minPar:"1/2 cs", weekendPar:"1 cs"},
    {name:"Scallops, U10/20 dry pack",            pack:"10# cs",  minPar:"1/4 cs", weekendPar:"1 cs"},
    {name:"Andouille Sausage",                    pack:"10# cs",  minPar:"1/4 cs", weekendPar:"1/4 cs"},
    {name:"Bacon, Thick Sliced",                  pack:"7.5# cs", minPar:"1/2 cs", weekendPar:"1/2 cs"}
  ],
  sysco: [
    {name:"Butter Pats, Foil",                pack:"cs",       par:"1"},
    {name:"Butter, Salted",                   pack:"36/1#cs",  par:"1"},
    {name:"Caesar Dressing, Sysco",           pack:"1gal",     par:"2"},
    {name:"Eggs, Boiled, Pillow-Pack",        pack:"cs",       par:"1"},
    {name:"Shaved Parm",                      pack:"bag",      par:"2"},
    {name:"Sour Cream",                       pack:"4/5#cs",   par:"1"},
    {name:"Whipped Cream",                    pack:"cs",       par:"1"},
    {name:"Yogurt, Plain Lowfat",             pack:"6/32oz",   par:"1"},
    {name:"Ciabatta Buns",                    pack:"cs",       par:"1"},
    {name:"Mayonnaise, Dukes",                pack:"4/1gal",   par:"1"},
    {name:"Panini Bread",                     pack:"cs",       par:"1"},
    {name:"Sundried Tomatoes",                pack:"box",      par:"1"},
    {name:"AP Flour",                         pack:"25#",      par:"1"},
    {name:"Baking Powder",                    pack:"1/10#",    par:"1"},
    {name:"Coke Syrup", pack:"1/2 box", par:"1"},
    {name:"Diet Coke Syrup", pack:"1/2 box", par:"1"},
    {name:"Sprite Syrup", pack:"1/2 box", par:"1"},
    {name:"Ginger Ale Syrup", pack:"1/2 box", par:"1"},
    {name:"Cranberry Sauce, Whole Berry",     pack:"#10 can",  par:"1"},
    {name:"Splenda Packets",                  pack:"cs",       par:"1"},
    {name:"Garbanzo Beans",                   pack:"6/#10",    par:"1"},
    {name:"Honey, Clover",                    pack:"5#jug",    par:"2"},
    {name:"Lowry's Seasoning Salt",           pack:"5#tub",    par:"1"},
    {name:"Maple Syrup Blend",                pack:"4/1gal",   par:"1"},
    {name:"Oil, Fryer, Canola",          pack:"1/35lb",  par:"2"},
    {name:"Plastic Wrap 18\"",                pack:"roll",     par:"1"},
    {name:"Pellegrino, 500ml Glass",          pack:"cs",       par:"1"},
    {name:"Pellegrino, 1L glass",             pack:"cs",       par:"1"},
    {name:"Panna, 500ml Plastic",             pack:"cs",       par:"1"},
    {name:"Panna, 500ml Glass",               pack:"cs",       par:"1"},
    {name:"Pan Release",                      pack:"cs",       par:"1"},
    {name:"Salt, Kosher Morton's",            pack:"cs",       par:"1"},
    {name:"Salt, Table Grind Rounds",         pack:"cs",       par:"1"},
    {name:"Soy Sauce",                        pack:"1 gal",    par:"1"},
    {name:"Sugar Packets/Brown Packs",        pack:"cs",       par:"1"},
    {name:"Sugar, Granulated",                pack:"50#bag",   par:"1"},
    {name:"Sweet n' Low Packets/Splenda",     pack:"cs",       par:"1"},
    {name:"Tahini",                           pack:"jar",      par:"2"},
    {name:"Tomatillos, Canned",               pack:"6/#10",    par:"1"},
    {name:"Tomato Strips, Bienvenido",        pack:"6/#10",    par:"2"},
    {name:"White Vinegar",                    pack:"4/1gal",   par:"1"},
    {name:"Worchestershire Sauce",            pack:"1gal",     par:"1"},
    {name:"Vanilla Extract",                  pack:"gal",      par:"1"},
    {name:"Andouille Sausage",                pack:"cs",       par:"1"},
    {name:"Biscuits, Pillsbury Mini",         pack:"cs",       par:"1"},
    {name:"French Fries",                     pack:"cs",       par:"2"},
    {name:"Mango, Frozen",                    pack:"cs",       par:"1"},
    {name:"Juice Cranberry Cocktail",         pack:"60oz case", par:"1"},
    {name:"Sauce Chocolate Dark",             pack:"64oz",     par:"1"},
    {name:"Sauce Caramel",                    pack:"64oz",     par:"1"},
  {name:"Ketchup Squeeze Red Upside Down",  pack:"16/20oz cs",par:"1 cs"},
  {name:"Dish Detergent",                   pack:"8/32oz cs",par:"1"},
  {name:"Panko Bread Crumbs",               pack:"25# cs",   par:"1"},
  {name:"Balsamic Vinegar",                 pack:"0.5L",     par:"2"}  
  ],
  igf: [
    {name:"Feta Cheese",                 pack:"case",    par:"1"},
    {name:"Fontal Cheese",               pack:"wedge",   par:"2"},
    {name:"Gorgonzola",                  pack:"wheel",   par:"1"},
    {name:"Manchego Cheese",             pack:"wheel",   par:"1"},
    {name:"Mascarpone",                  pack:"6/1#",    par:"2"},
    {name:"Romano Cheese",               pack:"1/4 wheel", par:"1"},
    {name:"Anchovies",                   pack:"tin",     par:"2"},
    {name:"Capers, Nonpareilles",        pack:"jar",     par:"2"},
    {name:"Caperberries",                pack:"jar",     par:"2"},
    {name:"Cherries, Maraschino, w/stem",pack:"gal",     par:"1"},
    {name:"Cornichons",                  pack:"gal",     par:"1"},
    {name:"Demi-Glace Veal",             pack:"16#",     par:"1"},
    {name:"Dijon Mustard",               pack:"gal",     par:"1"},
    {name:"Dolmas",                      pack:"can",     par:"1"},
    {name:"Gigandes",                    pack:"can",     par:"3"},
    {name:"Green Olives, Queen",         pack:"1 gal",   par:"1"},
    {name:"Mixed Greek Olives",          pack:"cs",      par:"1"},
    {name:"Nicoise Olives, pitted",      pack:"tub",     par:"1"},
    {name:"Phyllo Dough, Ready 2Go",     pack:"cs",      par:"1"},
    {name:"Pine Nuts",                   pack:"bag",     par:"1"},
    {name:"Pita Bread, 7\" Pocketless",  pack:"cs",      par:"1"},
    {name:"Plum Sauce (Sauce Prunes)",   pack:"can",     par:"1"},
    {name:"Strawberry Preserves",        pack:"jar",     par:"2"},
    {name:"Carnaroli Rice",              pack:"cs",      par:"1"},
    {name:"Clam Juice",                  pack:"cs",      par:"1"},
    {name:"Pearl Couscous",              pack:"bag",     par:"1"},
    {name:"Dried Cherries",              pack:"5# bag",  par:"1"},
    {name:"Gaufrettes",                  pack:"cs",      par:"1"},
    {name:"Ladyfingers",                 pack:"cs",      par:"1"},
    {name:"Olive Oil EV",                pack:"Can",     par:"4"},
    {name:"Olive Oil Blend",             pack:"Btl",     par:"6"},
    {name:"Pasta Angel Hair",            pack:"cs",      par:"1"},
    {name:"Pasta, Gemelli",              pack:"cs",      par:"1"},
    {name:"Pasta Fettucine",             pack:"cs",      par:"1"},
    {name:"Polenta",                     pack:"cs",      par:"1"},
    {name:"Red Wine Vinegar",            pack:"jug",     par:"1"},
    {name:"Rice Vinegar",                pack:"Gal",     par:"1"},
    {name:"Roasted Red Pepper, Divina",  pack:"3/cs",    par:"1"},
    {name:"Saffron",                     pack:"oz",      par:"1"},
    {name:"Goat/Mush Ravioli",           pack:"cs",      par:"1"},
    {name:"Pancetta",                    pack:"pc",      par:"2"},
    {name:"Sorbet",                      pack:"tub",     par:"1"},
    {name:"Spanokopita",                 pack:"cs",      par:"1"},
    {name:"Squash Ravioli",              pack:"cs",      par:"1"},
  {name:"Hazelnut Flour",              pack:"5# bag",  par:"1"},
  {name:"Taramasolata",                pack:"cs",      par:"1 cs"},
  {name:"Blue Cheese Stuffed Olives",  pack:"Jar",     par:"1"}
  ],
  bar: [
    {name:"Agave Syrup",                 pack:"bottle",  par:"1"},
    {name:"Amba",                        pack:"Case",    par:"1"},
    {name:"Baby Green Peas",             pack:"bags",    par:"6"},
    {name:"Bitters, Angostura",          pack:"Btl",     par:"1"},
    {name:"Bitters, Orange, Regan's",    pack:"Btl",     par:"1"},
    {name:"Bitters, Peach",              pack:"btl",     par:"1"},
    {name:"Bitters, Walnut",             pack:"Btl",     par:"1"},
    {name:"Buttermilk, Big",             pack:"1/2 gal", par:"2"},
    {name:"Buttermilk, Small",           pack:"qt",      par:"1"},
    {name:"Candied Ginger",              pack:"bag",     par:"2"},
    {name:"Chicken Stock",               pack:"cs",      par:"3"},
    {name:"Coconut Milk",                pack:"Case",    par:"1"},
    {name:"Cranberry Juice",             pack:"Btl",     par:"2"},
    {name:"Flowers",                     pack:"Bunch",   par:"5"},
    {name:"Grapefruit juice",            pack:"1/2 gal", par:"1"},
    {name:"Ketchup",                     pack:"2-pack",  par:"2"},
    {name:"Milk, Whole",                 pack:"Gal",     par:"2"},
    {name:"Orange Juice",                pack:"Carton",  par:"4"},
    {name:"Peach Nectar",                pack:"Btl",     par:"1"},
    {name:"Pineapple Juice",             pack:"6pk",     par:"1"},
    {name:"Powdered Sugar",              pack:"bag",     par:"1"},
    {name:"Tabasco",                     pack:"Btl",     par:"2"},
    {name:"Blue Cheese Stuffed Olives",  pack:"Jar",     par:"3"},
    {name:"Glass Cleaner",               pack:"Btl",     par:"2"},
    {name:"Rice Flour",                  pack:"cs",      par:"1"}
  ],
  sidney: [
    // Large Spices (handles)
    {name:"Large Spices (handles)",      isHeader:true},
    {name:"Coarse Ground Black Pepper",  pack:"", par:""},
    {name:"Dried Lemon Peel",            pack:"", par:""},
    {name:"Fine Ground Black Pepper",    pack:"", par:""},
    {name:"Granulated Garlic",           pack:"", par:""},
    {name:"Granulated Onion",            pack:"", par:""},
    {name:"Ground Cayenne Pepper",       pack:"", par:""},
    {name:"Ground Cinnamon",             pack:"", par:""},
    {name:"Ground Coriander",            pack:"", par:""},
    {name:"Ground Cumin",                pack:"", par:""},
    {name:"Quarter Cracked Black Pepper",pack:"", par:""},
    {name:"Sweet Spanish Paprika",       pack:"", par:""},
    {name:"Whole Mexican Oregano Leaf",  pack:"", par:""},
    {name:"Whole Tellicherry Peppercorns", pack:"", par:""},

    // Small Spices
    {name:"Small Spices",                isHeader:true},
    {name:"Dill, Whole",                 pack:"", par:""},
    {name:"Ground Allspice",             pack:"", par:""},
    {name:"Ground Bay Leaf",             pack:"", par:""},
    {name:"Ground Cardamom",             pack:"", par:""},
    {name:"Ground Cloves",               pack:"", par:""},
    {name:"Ground Nutmeg",               pack:"", par:""},
    {name:"Ground Oregano",              pack:"", par:""},
    {name:"Ground Sumac",                pack:"", par:""},
    {name:"Ground Thyme",                pack:"", par:""},
    {name:"Ground White Pepper",         pack:"", par:""},
    {name:"Guajillo Powder",             pack:"", par:""},
    {name:"Pasilla Negra Powder",        pack:"", par:""},
    {name:"Whole Cloves",                pack:"", par:""},

    // Other
    {name:"Other",                       isHeader:true},
    {name:"Almonds, Sliced Blanched",    pack:"", par:""},
    {name:"Hazelnuts, Blanched",         pack:"", par:""},
    {name:"Walnut Halves",               pack:"", par:""},
    {name:"Custom Gold Crab Base",       pack:"", par:""},
    {name:"Custom Gold Mushroom Base",   pack:"", par:""},
    {name:"Custom Gold Shrimp Base",     pack:"", par:""},
    {name:"Hafner Melba Toasts",         pack:"", par:""},
    {name:"Panko Bread Crumbs, Soft",    pack:"", par:""},
    {name:"Roland Balsamic Vinegar, 2/5L", pack:"", par:""}
  ]
};
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DOM refs & constants
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tbody = document.querySelector('#itemsTable tbody');
const tableHead = document.querySelector('#tableHead');
const vendorSel = document.querySelector('#vendor');
const filterInput = document.getElementById('filter');
const PHONE_NUMBER = '+16465761431';
const { jsPDF } = window.jspdf;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Rendering
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadInventory(vendor){
  tbody.innerHTML = '';
  tableHead.innerHTML = '';

  if(vendor==='royal' || vendor==='meats'){
    tableHead.innerHTML = '<th>Item</th><th>Pack Size</th><th>Min Par</th><th>Weekend Par</th><th>Order</th>';
    INVENTORY[vendor].forEach(item=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td data-label="Item">${item.name}</td>
        <td data-label="Pack Size">${item.pack}</td>
        <td data-label="Min Par">${item.minPar}</td>
        <td data-label="Weekend Par">${item.weekendPar}</td>
        <td data-label="Order"><input type="number" class="order" value="0" min="0" step="1" inputmode="numeric" enterkeyhint="done"></td>
      `;
      tbody.appendChild(tr);
    });
  } else if(vendor==='sysco' || vendor==='igf' || vendor==='bar' || vendor==='sidney'){
    tableHead.innerHTML = '<th>Item</th><th>Pack Size</th><th>Par</th><th>Order</th>';
    INVENTORY[vendor].forEach(item=>{
      const tr = document.createElement('tr');
      if(item.isHeader){
        tr.innerHTML = `<td colspan="4" class="section-header">${item.name}</td>`;
      } else {
        tr.innerHTML = `
          <td data-label="Item">${item.name}</td>
          <td data-label="Pack Size">${item.pack}</td>
          <td data-label="Par">${item.par}</td>
          <td data-label="Order"><input type="number" class="order" value="0" min="0" step="1" inputmode="numeric" enterkeyhint="done"></td>
        `;
      }
      tbody.appendChild(tr);
    });
  }
}

function applyFilter(){
  const q=(filterInput.value||'').trim().toLowerCase();
  document.querySelectorAll('#itemsTable tbody tr').forEach(tr=>{
    const txt=tr.textContent.toLowerCase();
    tr.style.display = q && !txt.includes(q) ? 'none' : '';
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Build SMS summary â†’ ONLY "Item | Par" where Order > 0
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildOrderSummary(vendor){
  const lines=[`Vendor: ${vendor.toUpperCase()}`];

  tbody.querySelectorAll('tr').forEach(tr=>{
    const inputs = tr.querySelectorAll('input.order');
    if(!inputs.length) return; // skip header rows
    const input = inputs[0];
    const order = Number(input.value || 0);
    if(order <= 0) return;

    const tds=[...tr.querySelectorAll('td')];
    if(vendor==='royal' || vendor==='meats'){
      const item = tds[0].innerText.trim();
      const minPar = tds[2].innerText.trim();
      const weekendPar = tds[3].innerText.trim();
      const parText = weekendPar ? `${minPar} / ${weekendPar}` : minPar;
      lines.push(`${item} | ${parText}`);
    } else {
      const item = tds[0].innerText.trim();
      const par = tds[2].innerText.trim();
      lines.push(`${item} | ${par}`);
    }
  });

  if(lines.length===1){ lines.push('(No items ordered)'); }
  return lines.join('\n');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PDF generation
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generatePdfForVendor(vendor){
  const doc = new jsPDF({unit:'pt',format:'a4'});
  doc.setFontSize(14);
  doc.text('Vendor Purchase Order',40,40);
  const rows=[];
  tbody.querySelectorAll('tr').forEach(tr=>{
    const cols=tr.querySelectorAll('td');
    if(!cols.length) return;

    if(vendor==='royal'||vendor==='meats'){
      const inputCell = cols[4]?.querySelector('input');
      const order = inputCell ? inputCell.value : 0;
      if(order>0){
        const item=cols[0].innerText;
        const pack=cols[1].innerText;
        const minPar=cols[2].innerText;
        const weekendPar=cols[3].innerText;
        rows.push([item,pack,minPar,weekendPar,order]);
      }
    } else {
      const inputCell = cols[3]?.querySelector('input');
      const order = inputCell ? inputCell.value : 0;
      if(order>0){
        const item=cols[0].innerText;
        const pack=cols[1].innerText;
        const par=cols[2].innerText;
        rows.push([item,pack,par,order]);
      }
    }
  });
  if(vendor==='royal'||vendor==='meats'){
    doc.autoTable({head:[["Item","Pack Size","Min Par","Weekend Par","Order"]],body:rows,startY:60});
  } else {
    doc.autoTable({head:[["Item","Pack Size","Par","Order"]],body:rows,startY:60});
  }
  const blob = doc.output('blob');
  const fileName = `PO-${vendor}-${new Date().toISOString().slice(0,10)}.pdf`;
  return { doc, blob, fileName, rowsCount: rows.length };
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Init
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init(){
  loadInventory('royal');
  vendorSel.addEventListener('change', e=>{ loadInventory(e.target.value); applyFilter(); });
  if(filterInput){ filterInput.addEventListener('input', applyFilter); }

  document.querySelector('#poForm').addEventListener('submit', function(e){
    e.preventDefault();
    const vendor=vendorSel.value;
    const { doc, fileName } = generatePdfForVendor(vendor);
    doc.save(fileName);
  });

  document.getElementById('shareBtn').addEventListener('click', async function(){
    const vendor=vendorSel.value;
    const { blob, fileName } = generatePdfForVendor(vendor);
    const summaryText=buildOrderSummary(vendor);
    try{
      const pdfFile=new File([blob], fileName, {type:'application/pdf'});
      if(navigator.share && navigator.canShare && navigator.canShare({files:[pdfFile]})){
        await navigator.share({files:[pdfFile], title:'Purchase Order', text: summaryText});
        return;
      }
    }catch(err){ console.warn('Share failed or unsupported', err); }
    const smsBody=encodeURIComponent(summaryText);
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform==="MacIntel" && navigator.maxTouchPoints>1);
    const smsURL = isIOS ? `sms:&body=${smsBody}` : `sms:${PHONE_NUMBER}?body=${smsBody}`;
    try{ window.location.href=smsURL; }catch(_){ }
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download=fileName; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url),2000);
  });

  runSelfTests();
}

if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', init); else init();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Self-tests
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function runSelfTests(){
  const results=[];
  function test(name, fn){
    try{ fn(); results.push({name, ok:true}); }
    catch(e){ results.push({name, ok:false, msg:e.message}); }
  }

  test('Inventory present', ()=>{
    if(!INVENTORY || !Array.isArray(INVENTORY.royal) || INVENTORY.royal.length===0) throw new Error('Royal inventory missing');
  });

  test('Render Royal columns', ()=>{
    loadInventory('royal');
    const heads=[...document.querySelectorAll('#tableHead th')].map(h=>h.textContent.trim());
    if(heads.join('|')!== 'Item|Pack Size|Min Par|Weekend Par|Order') throw new Error('Royal header mismatch');
  });
  test('Render Sysco columns', ()=>{
    loadInventory('sysco');
    const heads=[...document.querySelectorAll('#tableHead th')].map(h=>h.textContent.trim());
    if(heads.join('|')!== 'Item|Pack Size|Par|Order') throw new Error('Sysco header mismatch');
  });
  test('Render Bar columns', ()=>{
    loadInventory('bar');
    const heads=[...document.querySelectorAll('#tableHead th')].map(h=>h.textContent.trim());
    if(heads.join('|')!== 'Item|Pack Size|Par|Order') throw new Error('Bar header mismatch');
  });
  test('Render Sidney columns', ()=>{
    loadInventory('sidney');
    const heads=[...document.querySelectorAll('#tableHead th')].map(h=>h.textContent.trim());
    if(heads.join('|')!== 'Item|Pack Size|Par|Order') throw new Error('Sidney header mismatch');
  });
  test('Share button exists', ()=>{
    if(!document.getElementById('shareBtn')) throw new Error('Share button missing');
  });

  loadInventory(vendorSel.value||'royal');

  const el=document.getElementById('testStatus');
  if(el){
    const ok=results.every(r=>r.ok);
    el.textContent = ok ? 'Self-tests passed' : 'Self-tests: '+results.map(r=>`${r.ok?'âœ…':'âŒ'} ${r.name}${r.msg?(' - '+r.msg):''}`).join(' | ');
    el.style.color = ok ? '#155724' : '#721c24';
    el.style.background = ok ? '#d4edda' : '#f8d7da';
    el.style.border = ok ? '1px solid #c3e6cb' : '1px solid #f5c6cb';
  }
}
</script>
</body>
</html>
